<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë„ì„œê´€ ëŒ€ì¶œ/ë°˜ë‚© ì‹œìŠ¤í…œ</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    input, select, button { margin: 5px 0; padding: 5px; }
    .book-list { margin-top: 20px; }
    .book-item { margin-bottom: 8px; }
    .borrowed { color: red; }
  </style>
</head>
<body>
  <h1>ğŸ“š ë„ì„œê´€ ëŒ€ì¶œ/ë°˜ë‚© ì‹œìŠ¤í…œ</h1>

  <label>ì‚¬ìš©ì ì´ë¦„: <input type="text" id="username" /></label><br>
  <label>ë„ì„œ ì œëª©: <input type="text" id="bookTitle" /></label><br>
  <label>ì‘ì—… ì„ íƒ:
    <select id="action">
      <option value="borrow">ëŒ€ì¶œ</option>
      <option value="return">ë°˜ë‚©</option>
      <option value="extend">ê¸°í•œ ì—°ì¥</option>
    </select>
  </label><br>
  <button onclick="handleAction()">ì‹¤í–‰</button>

  <div class="book-list">
    <h2>ğŸ“– ë„ì„œ ëª©ë¡</h2>
    <div id="bookList"></div>
  </div>

  <script>
    const MAX_BORROW = 3;

    const books = [
      { title: "1984", isBorrowed: false, borrower: null, dueDate: null },
      { title: "ë°ë¯¸ì•ˆ", isBorrowed: false, borrower: null, dueDate: null },
      { title: "ì£„ì™€ ë²Œ", isBorrowed: false, borrower: null, dueDate: null },
      { title: "ë°±ë…„ ë™ì•ˆì˜ ê³ ë…", isBorrowed: false, borrower: null, dueDate: null },
      { title: "íŒŒìš°ìŠ¤íŠ¸", isBorrowed: false, borrower: null, dueDate: null },
    ];

    const userBorrowMap = {};

    function updateBookList() {
      const listDiv = document.getElementById("bookList");
      listDiv.innerHTML = "";
      books.forEach(book => {
        const div = document.createElement("div");
        div.className = "book-item";
        div.innerHTML = `<strong>${book.title}</strong> - ${book.isBorrowed ? 
          `<span class="borrowed">[ëŒ€ì¶œ ì¤‘] ${book.borrower} / ê¸°í•œ: ${book.dueDate}</span>` :
          `[ëŒ€ì¶œ ê°€ëŠ¥]`}`;
        listDiv.appendChild(div);
      });
    }

    function handleAction() {
      const username = document.getElementById("username").value.trim();
      const bookTitle = document.getElementById("bookTitle").value.trim();
      const action = document.getElementById("action").value;

      if (!username || !bookTitle) {
        alert("ì‚¬ìš©ì ì´ë¦„ê³¼ ë„ì„œ ì œëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
        return;
      }

      const book = books.find(b => b.title === bookTitle);
      if (!book) {
        alert("í•´ë‹¹ ë„ì„œëŠ” ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return;
      }

      if (!userBorrowMap[username]) userBorrowMap[username] = [];

      if (action === "borrow") {
        if (book.isBorrowed) {
          alert("ì´ë¯¸ ëŒ€ì¶œ ì¤‘ì¸ ë„ì„œì…ë‹ˆë‹¤.");
        } else if (userBorrowMap[username].length >= MAX_BORROW) {
          alert(`ìµœëŒ€ ${MAX_BORROW}ê¶Œê¹Œì§€ë§Œ ëŒ€ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
        } else {
          book.isBorrowed = true;
          book.borrower = username;
          const dueDate = new Date();
          dueDate.setDate(dueDate.getDate() + 14);
          book.dueDate = dueDate.toISOString().split("T")[0];
          userBorrowMap[username].push(bookTitle);
          alert(`âœ… '${bookTitle}' ëŒ€ì¶œ ì™„ë£Œ! ë°˜ë‚© ê¸°í•œ: ${book.dueDate}`);
        }

      } else if (action === "return") {
        if (!book.isBorrowed || book.borrower !== username) {
          alert("ë°˜ë‚©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. (ëŒ€ì¶œìê°€ ì•„ë‹˜)");
        } else {
          book.isBorrowed = false;
          book.borrower = null;
          book.dueDate = null;
          userBorrowMap[username] = userBorrowMap[username].filter(t => t !== bookTitle);
          alert(`âœ… '${bookTitle}' ë°˜ë‚© ì™„ë£Œ!`);
        }

      } else if (action === "extend") {
        if (!book.isBorrowed || book.borrower !== username) {
          alert("ê¸°í•œ ì—°ì¥ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.");
        } else {
          const newDate = new Date(book.dueDate);
          newDate.setDate(newDate.getDate() + 7);
          book.dueDate = newDate.toISOString().split("T")[0];
          alert(`âœ… '${bookTitle}' ë°˜ë‚© ê¸°í•œ ì—°ì¥: ${book.dueDate}`);
        }
      }

      updateBookList();
    }

    updateBookList();
  </script>
</body>
</html>
